{{= _fn.loadPartial('_header') }}

<h1 class="container mb-4">Posts Stack</h1>

<form class="container" method="POST">
    <div class="container d-flex px-0 pb-2">
        <select class="custom-select custom-select-sm col-2 mr-2" name="action">
            <option value="null" selected>Select a bulk action</option>
            {{? $$VIEW.query.access !== 'bin' }}
            <option value="pinned">Pin</option>
            <option value="hidden">Hide</option>
            <option value="recycled">Recycle</option>
            {{??}}
            <option value="restored">Restore</option>
            <option value="deleted">Permanently Delete</option>
            {{?}}

        </select>
        <button class="btn btn-sm btn-outline-primary" aria-label="Apply"
                formaction="/site/stack/blog?_method=PATCH" >Apply</button>
        <div class="ml-auto">
            {{? $$VIEW.query.access !== 'bin' }}
            <a class="btn btn-sm btn-outline-success" href="{{= $$VIEW.route }}?access=bin">RECYCLE BIN</a>
            {{??}}
            <a class="btn btn-sm btn-outline-primary" href="{{= $$VIEW.route }}">UNTRASHED</a>
            {{?}}
        </div>
    </div>
    <table class="table table-sm table-hover">
        <thead>
        <tr>
            <th class="text-center" scope="col" width="3%">
                <label for="select-all" class="m-0"><input id="select-all" type="checkbox"></label>
            </th>
            <th scope="col" width="41%">Title</th>
            <th scope="col" width="14%">Category</th>
            <th scope="col" width="14%">Tags</th>
            <th scope="col" width="14%">Author</th>
            <th scope="col" width="14%">Time</th>
        </tr>
        </thead>
        <tbody>
        {{? $$LIST.length > 0 }}
        {{ $$LIST.forEach(function(post) { }}
        <tr>
            <th class="text-center" scope="row">
                <label for="{{= post._id }}" class="m-0">
                    <input id="{{= post._id }}" name="target" type="checkbox" value="{{= post._id }}">
                </label>
            </th>
            <td>
                {{? !post.time._recycled }}
                <a href="/blog/{{= post._id }}/edit">{{= post.title }}</a>
                {{??}}
                {{= post.title }}
                {{?}}{{? post.state.pended }}<i class="fa fa-hourglass-half"></i>{{?}}                                   <!-- tofix: mongo virtual properties are not functioned here -->
                {{? post.state.hidden }}<i class="fa fa-eye-slash"></i>{{?}}
                {{? post.state.pinned }}<i class="fa fa-thumb-tack"></i>{{?}}
            </td>
            <td>{{= post.category }}</td>
            <td>{{= post.tags }}</td>
            <td>{{= post.author.nickname }}</td>
            <td>{{= new Date(post.time._created).toDateString() }}</td>
        </tr>
        {{ }); }}{{?}}
        </tbody>
    </table>
</form>

{{= _widget.pagination }}
{{= _fn.loadPartial('_footer') }}
